<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mosecat Game</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-0: #050f20;
      --bg-1: #0e2743;
      --card: rgba(10, 31, 54, 0.88);
      --line: #28527a;
      --text: #eaf4ff;
      --sub: #a7c3e2;
      --accent: #ff8f1f;
      --ok: #20d290;
      --warn: #f4b13d;
      --bad: #ef6d6d;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      min-height: 100%;
    }

    body {
      font-family: "Exo 2", "Noto Sans SC", sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 22% 12%, rgba(33, 86, 142, 0.36), transparent 35%),
        radial-gradient(circle at 78% 86%, rgba(114, 66, 16, 0.34), transparent 34%),
        linear-gradient(145deg, var(--bg-0), var(--bg-1));
      padding: 16px;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .card {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: var(--card);
      box-shadow: 0 16px 34px rgba(2, 10, 20, 0.35);
    }

    .home-layout {
      max-width: 560px;
      margin: 8vh auto 0;
      padding: 20px;
      display: grid;
      gap: 14px;
    }

    .eyebrow {
      margin: 0;
      letter-spacing: 0.16em;
      font-size: 12px;
      color: var(--sub);
      text-transform: uppercase;
    }

    h1 {
      margin: 8px 0 4px;
      font-size: 30px;
    }

    .desc {
      margin: 0;
      color: var(--sub);
    }

    .field {
      display: grid;
      gap: 8px;
    }

    .input,
    .select,
    .textarea,
    .btn {
      font: inherit;
      border-radius: 10px;
      border: 1px solid var(--line);
      color: var(--text);
      background: #102e4a;
    }

    .input,
    .select,
    .textarea {
      width: 100%;
      padding: 10px 12px;
    }

    .textarea {
      min-height: 130px;
      resize: vertical;
      font-family: "Consolas", "Monaco", monospace;
    }

    .btn {
      cursor: pointer;
      padding: 9px 14px;
      font-weight: 600;
      transition: opacity 0.15s ease;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .btn-primary {
      background: linear-gradient(120deg, var(--accent), #ffb058);
      color: #2a1603;
      border: none;
    }

    .btn-secondary {
      background: #1a446d;
    }

    .game-layout {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 12px;
    }

    .panel {
      padding: 12px;
      display: grid;
      gap: 10px;
    }

    .top-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .status-row {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }

    .status-item {
      border: 1px solid #2c5881;
      border-radius: 10px;
      background: rgba(16, 46, 75, 0.72);
      padding: 8px;
      display: grid;
      gap: 4px;
    }

    .status-item small {
      color: var(--sub);
      font-size: 12px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 118px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid #3a678f;
      background: rgba(18, 51, 82, 0.72);
      font-size: 12px;
    }

    .badge.connected {
      border-color: rgba(32, 210, 144, 0.8);
      color: #d7ffef;
    }

    .badge.connecting {
      border-color: rgba(244, 177, 61, 0.8);
      color: #ffe6b5;
    }

    .badge.disconnected {
      border-color: rgba(239, 109, 109, 0.8);
      color: #ffd4d4;
    }

    #gameCanvas {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #2f5e8a;
      background: #0a1f38;
    }

    .quick-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .quick-actions .btn {
      min-width: 92px;
    }

    .notice-list {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 6px;
      max-height: 220px;
      overflow: auto;
    }

    .notice-item {
      border: 1px solid #2f587d;
      border-radius: 8px;
      padding: 6px 8px;
      font-size: 12px;
      background: rgba(13, 40, 66, 0.75);
      display: grid;
      grid-template-columns: auto auto 1fr;
      gap: 8px;
      align-items: center;
    }

    .notice-time {
      color: #8fb4da;
    }

    .notice-level {
      text-transform: uppercase;
      font-weight: 700;
    }

    .notice-level.error {
      color: #ffaaaa;
    }

    .notice-level.system {
      color: #b8d9ff;
    }

    .notice-level.notice {
      color: #ffd48f;
    }

    pre {
      margin: 0;
      border: 1px solid #2f5c86;
      border-radius: 10px;
      background: rgba(8, 27, 46, 0.95);
      color: #d8ebff;
      padding: 10px;
      max-height: 230px;
      overflow: auto;
      font-size: 12px;
      line-height: 1.45;
    }

    @media (max-width: 980px) {
      .game-layout {
        grid-template-columns: 1fr;
      }

      .status-row {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <section id="homeScreen" class="screen active">
    <div class="card home-layout">
      <p class="eyebrow">Mosecat</p>
      <h1>游戏大厅</h1>
      <p class="desc">随机地牢已生成，使用 WASD 或方向键移动到终点。</p>
      <div class="field">
        <label for="nicknameInput">昵称</label>
        <input id="nicknameInput" class="input" maxlength="20" placeholder="输入你的昵称">
      </div>
      <button id="startGameBtn" class="btn btn-primary" type="button">进入游戏</button>
    </div>
  </section>

  <section id="gameScreen" class="screen">
    <div class="game-layout">
      <div class="card panel">
        <div class="top-actions">
          <span id="connectionStatusBadge" class="badge disconnected">DISCONNECTED</span>
          <button id="backHomeBtn" class="btn btn-secondary" type="button">返回首页</button>
          <button id="reconnectBtn" class="btn btn-secondary" type="button">重连</button>
          <label>
            <input id="autoReconnectInput" type="checkbox" checked>
            自动重连
          </label>
        </div>

        <div class="status-row">
          <div class="status-item">
            <small>连接状态</small>
            <strong id="connectionValue">DISCONNECTED</strong>
          </div>
          <div class="status-item">
            <small>分数</small>
            <strong id="scoreValue">--</strong>
          </div>
          <div class="status-item">
            <small>回合</small>
            <strong id="roundValue">--</strong>
          </div>
          <div class="status-item">
            <small>结果</small>
            <strong id="resultValue">等待中</strong>
          </div>
        </div>

        <div class="card panel" style="padding: 10px;">
          <strong>阶段提示</strong>
          <span id="stageHintText">等待开始。</span>
        </div>

        <canvas id="gameCanvas" width="900" height="380"></canvas>

        <div id="quickActions" class="quick-actions">
          <button class="btn btn-secondary" type="button" data-action="moveUp">上移</button>
          <button class="btn btn-secondary" type="button" data-action="moveDown">下移</button>
          <button class="btn btn-secondary" type="button" data-action="moveLeft">左移</button>
          <button class="btn btn-secondary" type="button" data-action="moveRight">右移</button>
        </div>
      </div>

      <aside class="card panel">
        <h3 style="margin: 0;">事件日志</h3>
        <ul id="noticeList" class="notice-list"></ul>

        <h3 style="margin: 4px 0 0;">服务端状态</h3>
        <pre id="gameStateDump">{}</pre>
      </aside>
    </div>
  </section>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script type="module" src="/game/main.js"></script>
</body>
</html>
